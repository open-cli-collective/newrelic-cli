# Chocolatey Package for newrelic-cli

This directory contains the Chocolatey package definition for newrelic-cli.

## Package Structure

```
chocolatey/
├── newrelic-cli.nuspec          # Package metadata
├── tools/
│   ├── chocolateyInstall.ps1    # Installation script
│   └── chocolateyUninstall.ps1  # Uninstallation script
└── README.md                    # This file
```

## How It Works

### Build-Time Checksum Injection

The `chocolateyInstall.ps1` script contains placeholder values for checksums:

```powershell
$checksumAmd64 = 'CHECKSUM_AMD64_PLACEHOLDER'
$checksumArm64 = 'CHECKSUM_ARM64_PLACEHOLDER'
```

During the release workflow, these placeholders are replaced with actual SHA256 checksums from the `checksums.txt` file generated by GoReleaser.

### Architecture Detection

The install script automatically detects:
- **ARM64**: Uses `windows_arm64.zip`
- **x64**: Uses `windows_amd64.zip`
- **32-bit**: Throws an error (not supported)

## Chocolatey Moderation Rules

This package is designed to pass Chocolatey's automated moderation:

| Rule | Description | How We Comply |
|------|-------------|---------------|
| CPMR0041 | projectUrl must differ from projectSourceUrl | projectUrl has `#readme` fragment |
| CPMR0055 | No custom downloaders | Uses `Install-ChocolateyZipPackage` only |
| CPMR0073 | Checksums required | SHA256 checksums injected at build time |

## Local Testing

To test the package locally (requires Windows):

```powershell
# Pack the package (version will be 0.0.0)
choco pack

# Install locally for testing
choco install newrelic-cli -s . --pre

# Uninstall
choco uninstall newrelic-cli
```

## Publishing

Publishing is handled automatically by the GitHub Actions release workflow. Manual publishing can be done with:

```powershell
choco push newrelic-cli.<version>.nupkg --source https://push.chocolatey.org/ --key <API_KEY>
```

## References

- [Chocolatey Package Creation](https://docs.chocolatey.org/en-us/create/)
- [Chocolatey Moderation Rules](https://docs.chocolatey.org/en-us/community-repository/moderation/)
- [Install-ChocolateyZipPackage](https://docs.chocolatey.org/en-us/create/functions/install-chocolateyzippackage)
